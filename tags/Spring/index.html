<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="何恩 何恩之有 HenryLuo Henry Luo Blog 生活 项目 编程 henng h3nng"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="http://henng.com/atom.xml" title="HENNG" type="application/atom+xml"><link rel="icon" href="images/favicon.ico"><title>Spring - HENNG</title><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro"><link rel="stylesheet" href="/css/main.css" type="text/css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">HENNG</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">HOME</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">ARCHIVES</a></li><li class="head-nav__item"><a href="/about" class="head-nav__link">ABOUT</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2015-06-04T03:08:54.000Z" class="post__time">六月 4, 2015</time><h1 class="post__title"><a href="/2015/06/04/ssh/">SSH 集合框架应用实例</a></h1></header><div class="post__main echo"><blockquote>
<p>本课程是基于 <a href="https://www.shiyanlou.com" target="_blank" rel="external">实验楼</a> 线上环境制作的，因此文档叙述和截图均与其有关。使用其他实验环境也没有太大影响，实验步骤是类似的。</p>
</blockquote>
<h2 id="一、实验说明及介绍">一、实验说明及介绍</h2><h3 id="1-_环境介绍">1. 环境介绍</h3><p>本实验环境采用带桌面的 Ubuntu Linux 环境，实验中可能会用到桌面上的程序：<a id="more"></a></p>
<ul>
<li>XfceTerminal：Linux 命令行终端，打开后会进入 Bash 环境，可以使用 Linux 命令</li>
<li>Firefox：浏览器，Web 应用会用到它</li>
<li>GVim：非常好用的编辑器，最简单的用法可以参考课程 <a href="http://www.shiyanlou.com/courses/2" target="_blank" rel="external">Vim编辑器</a></li>
<li>Eclipse：Eclipse 是著名的跨平台的自由集成开发环境（IDE）。主要用来 Java 语言开发，但是目前亦有人通过插件使其作为 C++ 和 Python 等语言的开发工具</li>
</ul>
<h3 id="2-_实验简介">2. 实验简介</h3><p>很多同学可能先后学习了 Spring、Struts 以及 Hibernate 课程（学习本项目课之前，您也应该先学习这三门课程）：</p>
<ul>
<li><a href="https://www.shiyanlou.com/courses/33" target="_blank" rel="external">Spring 框架入门教程</a></li>
<li><a href="https://www.shiyanlou.com/courses/32" target="_blank" rel="external">Struts 框架教程</a></li>
<li><a href="https://www.shiyanlou.com/courses/34" target="_blank" rel="external">Hibernate 框架教程</a></li>
</ul>
<p>今天我们就带给大家 3 种框架结合应用的实例，也就是常说的 SSH（Spring + Struts + Hibernate）集成框架，它是应用十分广泛的一种 Java Web 应用程序开发框架。通过这个例子，你会感受到 SSH 框架的强大之处，也会对之前学习的各种框架的应用和理解更加清晰、透彻。</p>
<ul>
<li>本次项目课的场景，假设为一个简单的用户管理网站，在数据库中存在的每一个用户都可以登录网站，然后可以在网站上面进行用户管理（增删改查）。<em>实际的使用场景可能不同，这里的场景假设只是为了便于大家学会理解和应用其中的相关操作</em>。</li>
</ul>
<h2 id="二、SSH_框架分析">二、SSH 框架分析</h2><p>SSH 框架也体现了典型的分层结构，分层有很多好处，例如项目整体的构架更加清晰，代码也更易维护和扩展。</p>
<p>通常来说，SSH 整体上大致可以用下图描述：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/8F73B524614342B5B4852A3A0CC7049F" alt=""></p>
<p>在后面的编码过程中，最好结合这个框架分析图来理解，会更加清晰。</p>
<h2 id="三、项目准备工作">三、项目准备工作</h2><h3 id="1-_New_Project">1. New Project</h3><p>新建 Dynamic Web Project，命名为 SSH（遇到窗口显示不完整的问题，请将窗口放到最大化即可）</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/F2386922DEBE49A7A767AE558E977BB1" alt=""></p>
<h3 id="2-_导入依赖包">2. 导入依赖包</h3><p>先下载依赖包（由于依赖包比较大，这里分成了 3 个小包分别下载，但都要导入到项目中）：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/labfile.oss.aliyuncs.com/courses</span><span class="regexp">/339/lib</span>-part1.zip</span><br><span class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/labfile.oss.aliyuncs.com/courses</span><span class="regexp">/339/lib</span>-part2.zip</span><br><span class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/labfile.oss.aliyuncs.com/courses</span><span class="regexp">/339/lib</span>-part3.zip</span><br></pre></td></tr></table></figure>
<p>分别解压 3 个小包，解压之后，<strong>将 3 个部分所有的 jar 包</strong>，全部都复制到工程目录下的 <code>WebContent/WEB-INF/lib</code> 目录下面（截图只包含部分 jar 包）：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/E46FB1C59106450FABF697627A989A67" alt=""></p>
<h3 id="3-_web-xml">3. web.xml</h3><p>修改 web.xml（WebContent/WEB-INF/web.xml）文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">web-app</span> <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span> </span><br><span class="line"><span class="attribute">xmlns</span>=<span class="value">"http://java.sun.com/xml/ns/javaee"</span> </span><br><span class="line"><span class="attribute">xsi:schemaLocation</span>=<span class="value">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> </span><br><span class="line"><span class="attribute">id</span>=<span class="value">"WebApp_ID"</span> <span class="attribute">version</span>=<span class="value">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">display-name</span>&gt;</span>SSH<span class="tag">&lt;/<span class="title">display-name</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="title">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">welcome-file</span>&gt;</span>login.jsp<span class="tag">&lt;/<span class="title">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">welcome-file-list</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 配置 spring --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">listener</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="title">listener-class</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="title">listener</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">&lt;!-- 配置 spring 资源文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="title">param-name</span>&gt;</span> </span><br><span class="line">  	<span class="tag">&lt;<span class="title">param-value</span>&gt;</span>classpath:beans.xml<span class="tag">&lt;/<span class="title">param-value</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="title">context-param</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">&lt;!-- 配置 struts --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="title">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="title">filter-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="title">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="title">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="title">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">filter-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="title">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-_package">4. package</h3><p>在 <code>Java Resources/src</code> 目录下，新建各层 package，方便后面的编码工作：</p>
<p><strong>PS：后续代码的讲解都在代码的注释中。</strong></p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/B282F8B2C0AC4884A150B60765EC72B2" alt=""></p>
<h3 id="5-_MySQL">5. MySQL</h3><h4 id="（1）启动_MySQL_服务">（1）启动 MySQL 服务</h4><p>输入密码：shiyanlou</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/4E84E832973F4FB3B435DE639C93CB51" alt=""></p>
<h4 id="（2）登录_MySQL">（2）登录 MySQL</h4><p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/ED3F736AFA7947779D7F33A1CC4DE99A" alt=""></p>
<h4 id="（3）新建数据库_ssh">（3）新建数据库 ssh</h4><p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/328EDDCA45A24ECD84C89AA950CA5AD3" alt=""></p>
<h2 id="四、Model">四、Model</h2><p>在 model 下新建一个实体类 <code>User.java</code>，以及它的映射文件 <code>User.hbm.xml</code>：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/C77DCD09460C4D01A22458E47108EE4A" alt=""></p>
<h3 id="1-_User-java">1. <code>User.java</code></h3><p>这个对象包含一个 id 主键，一个 name 属性以及 company 属性，很简单。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> shiyanlou.ssh.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String company;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCompany</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> company;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCompany</span><span class="params">(String company)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.company = company;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-_User-hbm-xml">2. <code>User.hbm.xml</code></h3><p>根据上面的对象，它的配置文件为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE hibernate-mapping PUBLIC</span><br><span class="line">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span><br><span class="line">        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">hibernate-mapping</span> <span class="attribute">package</span>=<span class="value">"shiyanlou.ssh.model"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- class 和 table 对应 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">class</span> <span class="attribute">name</span>=<span class="value">"User"</span> <span class="attribute">table</span>=<span class="value">"ssh_test"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	    <span class="comment">&lt;!-- 一一对应 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">id</span> <span class="attribute">name</span>=<span class="value">"id"</span> <span class="attribute">column</span>=<span class="value">"id"</span>&gt;</span><span class="tag">&lt;/<span class="title">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"name"</span> <span class="attribute">column</span>=<span class="value">"name"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span>		</span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"company"</span> <span class="attribute">column</span>=<span class="value">"company"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;/<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="五、Dao">五、Dao</h2><p>在 dao 下新建一个 <code>UserDao.java</code> 接口，以及它的实现类 <code>UserDaoImpl.java</code>：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/542596EF9E78426DA4D39C6F051551DA" alt=""></p>
<h3 id="1-_UserDao-java">1. <code>UserDao.java</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> shiyanlou.ssh.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> shiyanlou.ssh.model.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用以登录时检查数据库中是否存在该用户</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 添加用户</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 删除用户</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 修改用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 查询用户</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">queryById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 查询所有用户</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-_UserDaoImpl-java">2. <strong><code>UserDaoImpl.java</code></strong></h3><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">package shiyanlou.ssh.dao;</span><br><span class="line"></span><br><span class="line"><span class="built_in">import</span> java.util.ArrayList;</span><br><span class="line"><span class="built_in">import</span> java.util.List;</span><br><span class="line"><span class="built_in">import</span> org.hibernate.Query;</span><br><span class="line"><span class="built_in">import</span> org.hibernate.Session;</span><br><span class="line"><span class="built_in">import</span> org.hibernate.SessionFactory;</span><br><span class="line"></span><br><span class="line"><span class="built_in">import</span> shiyanlou.ssh.model.User;</span><br><span class="line"></span><br><span class="line">public class UserDaoImpl implements UserDao &#123;</span><br><span class="line"></span><br><span class="line">	private SessionFactory sessionFactory;</span><br><span class="line">	</span><br><span class="line">	public SessionFactory getSessionFactory<span class="params">()</span> &#123;</span><br><span class="line">		return sessionFactory;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setSessionFactory<span class="params">(SessionFactory sessionFactory)</span> &#123;</span><br><span class="line">		this.sessionFactory = sessionFactory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录时，检查用户是否存在于数据库中</span></span><br><span class="line">	@Override</span><br><span class="line">	public boolean checkUser<span class="params">(User user)</span> &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">		<span class="comment">// 开启 session</span></span><br><span class="line">		Session session = sessionFactory.openSession<span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 开启事务</span></span><br><span class="line">		session.beginTransaction<span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 查询语句</span></span><br><span class="line">		Query query = session.createQuery<span class="params">(<span class="string">" from User u where u.id=:id and u.name=:name"</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 设定查询语句中变量的值</span></span><br><span class="line">		query.setParameter<span class="params">(<span class="string">"id"</span>, user.getId<span class="params">()</span>)</span>;</span><br><span class="line">		query.setParameter<span class="params">(<span class="string">"name"</span>, user.getName<span class="params">()</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 查询结果</span></span><br><span class="line">		User u = <span class="params">(User)</span>query.uniqueResult<span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 事务提交并关闭 session</span></span><br><span class="line">		session.getTransaction<span class="params">()</span>.commit<span class="params">()</span>;</span><br><span class="line">		session.close<span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 查询结果不为 null，说明存在则返回 true</span></span><br><span class="line">		<span class="keyword">if</span> <span class="params">(null != u )</span> &#123;</span><br><span class="line">			return <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		return <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增加用户</span></span><br><span class="line">	@Override</span><br><span class="line">	public boolean addUser<span class="params">(User user)</span> &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">		Session session = sessionFactory.openSession<span class="params">()</span>;</span><br><span class="line">		session.beginTransaction<span class="params">()</span>;</span><br><span class="line">		session.save<span class="params">(user)</span>;</span><br><span class="line">		session.getTransaction<span class="params">()</span>.commit<span class="params">()</span>;</span><br><span class="line">		session.close<span class="params">()</span>;</span><br><span class="line">		return <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除用户</span></span><br><span class="line">	@Override</span><br><span class="line">	public boolean deleteUser<span class="params">(int id)</span> &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">		Session session = sessionFactory.openSession<span class="params">()</span>;</span><br><span class="line">		session.beginTransaction<span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 通过 id 找到该 user</span></span><br><span class="line">		User u = <span class="params">(User)</span>session.get<span class="params">(User.class, id)</span>;</span><br><span class="line">		session.delete<span class="params">(u)</span>;</span><br><span class="line">		session.getTransaction<span class="params">()</span>.commit<span class="params">()</span>;</span><br><span class="line">		session.close<span class="params">()</span>;</span><br><span class="line">		return <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新用户信息</span></span><br><span class="line">	@Override</span><br><span class="line">	public boolean updateUser<span class="params">(User user)</span> &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">		Session session = sessionFactory.openSession<span class="params">()</span>;</span><br><span class="line">		session.beginTransaction<span class="params">()</span>;</span><br><span class="line">		session.update<span class="params">(user)</span>;</span><br><span class="line">		session.getTransaction<span class="params">()</span>.commit<span class="params">()</span>;</span><br><span class="line">		session.close<span class="params">()</span>;</span><br><span class="line">		return <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户查询，用于在网页上根据不同条件的查询</span></span><br><span class="line">    <span class="comment">//（这里可以根据 name 或 company 查询，在后面的 JSP 页面中会体现）</span></span><br><span class="line">	@Override</span><br><span class="line">	public List&lt;User&gt; queryUser<span class="params">(User user)</span> &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">		Session session = sessionFactory.openSession<span class="params">()</span>;</span><br><span class="line">		session.beginTransaction<span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 使用 StringBuffer 便于后面根据不同条件，连接查询语句</span></span><br><span class="line">		StringBuffer hq = new StringBuffer<span class="params">(<span class="string">" from User u where 1=1"</span>)</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 参数的值的集合</span></span><br><span class="line">		ArrayList&lt;String&gt; params = new ArrayList&lt;String&gt;<span class="params">()</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// name 不为空，则在查询语句中连接 name 查询条件</span></span><br><span class="line">        <span class="comment">// 并添加 name 的值，便于后面查询</span></span><br><span class="line">		<span class="keyword">if</span> <span class="params">(user.getName<span class="params">()</span> != null &amp;&amp; !<span class="string">""</span>.equals<span class="params">(user.getName<span class="params">()</span>)</span>)</span> &#123;</span><br><span class="line">			hq.append<span class="params">(<span class="string">" and u.name=?"</span>)</span>;</span><br><span class="line">			params.add<span class="params">(user.getName<span class="params">()</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 同上</span></span><br><span class="line">		<span class="keyword">if</span> <span class="params">(user.getCompany<span class="params">()</span> != null &amp;&amp; !<span class="string">""</span>.equals<span class="params">(user.getCompany<span class="params">()</span>)</span>)</span> &#123;</span><br><span class="line">			hq.append<span class="params">(<span class="string">" and u.company=?"</span>)</span>;</span><br><span class="line">			params.add<span class="params">(user.getCompany<span class="params">()</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 根据参数的数量，设定查询条件的个数</span></span><br><span class="line">		Query query = session.createQuery<span class="params">(hq.toString<span class="params">()</span>)</span>;</span><br><span class="line">		<span class="keyword">for</span> <span class="params">(int i = <span class="number">0</span>; i &lt; params.size<span class="params">()</span>; i++)</span> &#123;</span><br><span class="line">			query.setString<span class="params">(i, params.get<span class="params">(i)</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 查询结果</span></span><br><span class="line">		List&lt;User&gt; users = query.list<span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		session.getTransaction<span class="params">()</span>.commit<span class="params">()</span>;</span><br><span class="line">		session.close<span class="params">()</span>;</span><br><span class="line">		return users;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过 id 查找用户</span></span><br><span class="line">	@Override</span><br><span class="line">	public User queryById<span class="params">(int id)</span> &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">		Session session = sessionFactory.openSession<span class="params">()</span>;</span><br><span class="line">		session.beginTransaction<span class="params">()</span>;</span><br><span class="line">		User u = <span class="params">(User)</span>session.get<span class="params">(User.class, id)</span>;</span><br><span class="line">		session.getTransaction<span class="params">()</span>.commit<span class="params">()</span>;</span><br><span class="line">		session.close<span class="params">()</span>;</span><br><span class="line">		return u;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查找所有用户</span></span><br><span class="line">	@Override</span><br><span class="line">	public List&lt;User&gt; queryAll<span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">		Session session = sessionFactory.openSession<span class="params">()</span>;</span><br><span class="line">		session.beginTransaction<span class="params">()</span>;</span><br><span class="line">		Query query = session.createQuery<span class="params">(<span class="string">" from User u"</span>)</span>;</span><br><span class="line">		List&lt;User&gt; users = query.list<span class="params">()</span>;</span><br><span class="line">		session.getTransaction<span class="params">()</span>.commit<span class="params">()</span>;</span><br><span class="line">		session.close<span class="params">()</span>;</span><br><span class="line">		return users;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-_hibernate-cfg-xml">3. <code>hibernate.cfg.xml</code></h3><p>在 <code>Java Resources/src</code> 目录下，新建 Hibernate 配置文件 <code>hibernate.cfg.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE hibernate-configuration PUBLIC</span><br><span class="line">        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span><br><span class="line">        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">hibernate-configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">session-factory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接设置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/ssh<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"connection.password"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据库方言设置：MySQL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment">&lt;!-- 开启 Hibernate 自动 session 管理 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 设置 SQL 语句输出到 Eclipse 控制台 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 第一次加载 hibernate 时根据 model 类会自动建立起表的结构（前提是先建立好数据库），以后加载 hibernate 时根据 model 类自动更新表结构，即使表结构改变了但表中的行仍然存在不会删除以前的行。--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 映射文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">mapping</span> <span class="attribute">resource</span>=<span class="value">"shiyanlou/ssh/model/User.hbm.xml"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">session-factory</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="六、Service">六、Service</h2><p>在 service 下新建一个 <code>UserService.java</code> 接口，以及它的实现类 <code>UserServiceImpl.java</code>，service 为 dao 的上层，它是直接调用 dao 层的相关操作的，相对来说要简单很多，因此这里也不详细解释了。</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/C668589532B1497F98C5C71AB3DCFA73" alt=""></p>
<h3 id="1-_UserService-java">1. <code>UserService.java</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> shiyanlou.ssh.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> shiyanlou.ssh.model.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">queryById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-_UserServiceImpl-java">2. <code>UserServiceImpl.java</code></h3><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package shiyanlou.ssh.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">List</span>;</span><br><span class="line"><span class="keyword">import</span> shiyanlou.ssh.dao.<span class="type">UserDao</span>;</span><br><span class="line"><span class="keyword">import</span> shiyanlou.ssh.model.<span class="type">User</span>;</span><br><span class="line"></span><br><span class="line">public class <span class="type">UserServiceImpl</span> implements <span class="type">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">	private <span class="type">UserDao</span> userDao;</span><br><span class="line">	</span><br><span class="line">	public <span class="type">UserDao</span> getUserDao() &#123;</span><br><span class="line">		<span class="keyword">return</span> userDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public <span class="type">void</span> setUserDao(<span class="type">UserDao</span> userDao) &#123;</span><br><span class="line">		this.userDao = userDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public boolean checkUser(<span class="type">User</span> user) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">if</span> ( userDao.checkUser(user) ) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public boolean addUser(<span class="type">User</span> user) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.addUser(user);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public boolean deleteUser(<span class="type">int</span> id) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.deleteUser(id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public boolean updateUser(<span class="type">User</span> user) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.updateUser(user);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">List</span>&lt;<span class="type">User</span>&gt; queryUser(<span class="type">User</span> user) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.queryUser(user);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">User</span> queryById(<span class="type">int</span> id) &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.queryById(id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">List</span>&lt;<span class="type">User</span>&gt; queryAll() &#123;</span><br><span class="line">		// <span class="type">TODO</span> <span class="type">Auto</span>-generated <span class="keyword">method</span> stub</span><br><span class="line">		<span class="keyword">return</span> userDao.queryAll();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="七、Action">七、Action</h2><p>在 action 包下，新建类 <code>UserAction.java</code>，action 为 service 的上层，所以它会调用 service：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/4E2B990C7E814C5AA9A7FB8317A2177D" alt=""></p>
<h3 id="1-_UserAction-java">1. <code>UserAction.java</code></h3><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> shiyanlou.ssh.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> shiyanlou.ssh.model.User;</span><br><span class="line"><span class="keyword">import</span> shiyanlou.ssh.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * </span><br><span class="line">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1</span>L;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	<span class="keyword">private</span> UserService userService;</span><br><span class="line">	<span class="keyword">private</span> Map&lt;String, Object&gt; request;</span><br><span class="line">	<span class="keyword">private</span> Map&lt;String, Object&gt; session;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function">User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function">UserService <span class="title">getUserService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setUserService</span><span class="params">(UserService userService)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userService = userService;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 将查询的所有结果放到上下文中</span></span><br><span class="line">	<span class="comment">// key 为 users，后面的 jsp 页面会用到</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		request = (Map)ActionContext.getContext().get(<span class="string">"request"</span>);</span><br><span class="line">		request.put(<span class="string">"users"</span>, userService.queryAll());</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 登录检查</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">String <span class="title">checkUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> flag = userService.checkUser(user);</span><br><span class="line">		<span class="comment">// 检查有效</span></span><br><span class="line">		<span class="keyword">if</span> (flag) &#123;</span><br><span class="line">		    <span class="comment">// 将当前 user 对象放到 session 中</span></span><br><span class="line">			session = ActionContext.getContext().getSession();</span><br><span class="line">			session.put(<span class="string">"user1"</span>, user);</span><br><span class="line">			<span class="comment">// 返回所有结果显示在页面</span></span><br><span class="line">			<span class="function"><span class="keyword">return</span> <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 检查无效</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 删除用户，之后再返回所有查询结果动态显示在页面上</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">String <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		userService.deleteUser(user.getId());</span><br><span class="line">		<span class="function"><span class="keyword">return</span> <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 同上</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">String <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		userService.addUser(user);</span><br><span class="line">		<span class="function"><span class="keyword">return</span> <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 修改用户信息，通过 id 找到要修改的用户</span></span><br><span class="line">	<span class="comment">// 并返回 "update" 字符串，用以跳转到修改页面</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">String <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		user = userService.queryById(user.getId());</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"update"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 在修改页面完成修改，调用 service 的 update</span></span><br><span class="line">	<span class="comment">// 之后再返回所有查询结果动态显示在页面上</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">String <span class="title">updateUserImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		userService.updateUser(user);</span><br><span class="line">		<span class="function"><span class="keyword">return</span> <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据条件查询用户，查询结果放到上下文中</span></span><br><span class="line">    <span class="comment">// tag 用以标记，后面在 jsp 页面有体现</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">String <span class="title">queryUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		request = (Map)ActionContext.getContext().get(<span class="string">"request"</span>);</span><br><span class="line">		request.put(<span class="string">"users2"</span>, userService.queryUser(user));</span><br><span class="line">		request.put(<span class="string">"tag"</span>, <span class="number">2</span>);</span><br><span class="line">		<span class="function"><span class="keyword">return</span> <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-_beans-xml">2. <code>beans.xml</code></h3><p>在 <code>Java Resources/src</code> 目录下新建 Spring 配置文件 <code>beans.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">beans</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       <span class="attribute">xmlns:context</span>=<span class="value">"http://www.springframework.org/schema/context"</span></span><br><span class="line">       <span class="attribute">xmlns:aop</span>=<span class="value">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">       <span class="attribute">xmlns:tx</span>=<span class="value">"http://www.springframework.org/schema/tx"</span></span><br><span class="line">       <span class="attribute">xsi:schemaLocation</span>=<span class="value">"http://www.springframework.org/schema/beans</span><br><span class="line">       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">       http://www.springframework.org/schema/context</span><br><span class="line">       http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">       http://www.springframework.org/schema/tx</span><br><span class="line">       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span><br><span class="line">       http://www.springframework.org/schema/aop</span><br><span class="line">       http://www.springframework.org/schema/aop/spring-aop-3.2.xsd"</span></span><br><span class="line">       <span class="attribute">default-autowire</span>=<span class="value">"byName"</span></span><br><span class="line">&gt;</span></span><br><span class="line">		</span><br><span class="line">		  <span class="comment">&lt;!-- sessionFactory 的配置 --&gt;</span></span><br><span class="line">		  <span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"sessionFactory"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"configLocation"</span> <span class="attribute">value</span>=<span class="value">"classpath:hibernate.cfg.xml"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">		  <span class="tag">&lt;/<span class="title">bean</span>&gt;</span> </span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 事物管理器 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"txManager"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">			  <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"sessionFactory"</span> <span class="attribute">ref</span>=<span class="value">"sessionFactory"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置哪些类哪些方法使用事务 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">aop:config</span>&gt;</span></span><br><span class="line">		    <span class="comment">&lt;!-- 只对 service 层实施事务 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">aop:pointcut</span> <span class="attribute">expression</span>=<span class="value">"execution(public * shiyanlou.ssh.service..*.*(..))"</span> <span class="attribute">id</span>=<span class="value">"businessService"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">aop:advisor</span> <span class="attribute">advice-ref</span>=<span class="value">"txAdvice"</span> <span class="attribute">pointcut-ref</span>=<span class="value">"businessService"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">aop:config</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 事务的传播特性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">tx:advice</span> <span class="attribute">id</span>=<span class="value">"txAdvice"</span> <span class="attribute">transaction-manager</span>=<span class="value">"txManager"</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="title">tx:attributes</span>&gt;</span></span><br><span class="line">		      <span class="tag">&lt;<span class="title">tx:method</span> <span class="attribute">name</span>=<span class="value">"check*"</span> <span class="attribute">read-only</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line">		      </span><br><span class="line">		    <span class="tag">&lt;/<span class="title">tx:attributes</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">tx:advice</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 各层的映射对应关系 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"userDao"</span> <span class="attribute">class</span>=<span class="value">"shiyanlou.ssh.dao.UserDaoImpl"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"sessionFactory"</span> <span class="attribute">ref</span>=<span class="value">"sessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"userService"</span> <span class="attribute">class</span>=<span class="value">"shiyanlou.ssh.service.UserServiceImpl"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"userDao"</span> <span class="attribute">ref</span>=<span class="value">"userDao"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"userAction"</span> <span class="attribute">class</span>=<span class="value">"shiyanlou.ssh.action.UserAction"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"userService"</span> <span class="attribute">ref</span>=<span class="value">"userService"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"><span class="tag">&lt;/<span class="title">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-_structs-xml">3. <code>structs.xml</code></h3><p>同样在 <code>Java Resources/src</code> 目录下，新建 Struts 配置文件 <code>struts.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE struts PUBLIC</span><br><span class="line">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span><br><span class="line">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">struts</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 启用开发者模式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">constant</span> <span class="attribute">name</span>=<span class="value">"struts.devMode"</span> <span class="attribute">value</span>=<span class="value">"true"</span>&gt;</span><span class="tag">&lt;/<span class="title">constant</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 启用动态方法调用 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">constant</span> <span class="attribute">name</span>=<span class="value">"struts.enable.DynamicMethodInvocation"</span> <span class="attribute">value</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 根据不同的返回结果，给出不同的响应界面 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">package</span> <span class="attribute">name</span>=<span class="value">"user"</span> <span class="attribute">extends</span>=<span class="value">"struts-default"</span>  <span class="attribute">namespace</span>=<span class="value">"/"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">action</span> <span class="attribute">name</span>=<span class="value">"user"</span> <span class="attribute">class</span>=<span class="value">"shiyanlou.ssh.action.UserAction"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="title">result</span> <span class="attribute">name</span>=<span class="value">"error"</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="title">result</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="title">result</span> <span class="attribute">name</span>=<span class="value">"success"</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="title">result</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="title">result</span> <span class="attribute">name</span>=<span class="value">"update"</span>&gt;</span>/updateuser.jsp<span class="tag">&lt;/<span class="title">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="title">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">package</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="八、JSP">八、JSP</h2><p>现在编码工作进入最后的阶段了，我们需要做的，就是根据前面的 Struts 的配置以及各种业务处理逻辑，建立各种 JSP 页面。</p>
<p>实验中，所有的页面，都在 <code>WebContent/</code> 下新建。</p>
<h3 id="1-_login-jsp">1. <code>login.jsp</code></h3><p>登录页面，也是程序启动的默认首页，登录时验证 id 和 name 是否存在于数据库中。</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="vbscript">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 获取相关路径 --&gt;</span>    </span><br><span class="line"></span><span class="vbscript">&lt;%</span><br><span class="line"><span class="built_in">String</span> path = <span class="built_in">request</span>.getContextPath();</span><br><span class="line"><span class="built_in">String</span> basePath = <span class="built_in">request</span>.getScheme()+<span class="string">"://"</span>+<span class="built_in">request</span>.getServerName()+<span class="string">":"</span>+<span class="built_in">request</span>.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>Login Page<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">center</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">h1</span>&gt;</span>Please Login First<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- 登录时 form 表单提交给 checkUser Action 处理 --&gt;</span>  </span><br><span class="line">    	<span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"</span></span></span><span class="vbscript">&lt;%=basePath%&gt;</span><span class="xml"><span class="tag"><span class="value">user!checkUser.action"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span></span><br><span class="line">    	User Id:<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.id"</span> <span class="attribute">style</span>=<span class="value">"width: 100px;"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">    	User Name<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.name"</span> <span class="attribute">style</span>=<span class="value">"width: 100px;"</span>/&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Login"</span>/&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="2-_success-jsp">2. <code>success.jsp</code></h3><p>登录验证成功，进入管理页面。</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="vbscript">&lt;%@ page language=<span class="string">"java"</span>  import=<span class="string">"java.util.*"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line"></span><span class="vbscript">&lt;%</span><br><span class="line"><span class="built_in">String</span> path = <span class="built_in">request</span>.getContextPath();</span><br><span class="line"><span class="built_in">String</span> basePath = <span class="built_in">request</span>.getScheme()+<span class="string">"://"</span>+<span class="built_in">request</span>.getServerName()+<span class="string">":"</span>+<span class="built_in">request</span>.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- c 标签，后面会使用到 --&gt;</span></span><br><span class="line"></span><span class="vbscript">&lt;%@taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span> %&gt;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>Welcome<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">"text/css"</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="tag">td</span><span class="rules">&#123;</span><br><span class="line">		<span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;</span><br><span class="line">		<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">	&#125;</span></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- checkUser Action 返回 user1，这里就可以得到用户名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">align</span>=<span class="value">"right"</span>&gt;</span>Welcome, $&#123;user1.name &#125; | <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"logout.jsp"</span>&gt;</span>Exit<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">center</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="title">table</span> <span class="attribute">border</span>=<span class="value">"1"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="title">tr</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="title">td</span>&gt;</span>user id<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>user name<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>company<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span> <span class="attribute">colspan</span>=<span class="value">"2"</span> <span class="attribute">style</span>=<span class="value">"center"</span>&gt;</span>Options<span class="tag">&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!-- UserAction 中的 list() 返回 users，遍历它就得到所有的查询结果 --&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="title">c:forEach</span> <span class="attribute">items</span>=<span class="value">"$&#123;users&#125;"</span> <span class="attribute">var</span>=<span class="value">"u"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 以表格形式展现所有结果，最后一栏是操作（包含删除和修改） --&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 删除、修改都提交给各自的 Action 处理，通过 id 来判断是哪个用户 --&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="title">tr</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="title">td</span>&gt;</span>$&#123;u.id&#125;<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>$&#123;u.name&#125;<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>$&#123;u.company&#125;<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"user!deleteUser.action?user.id=$&#123;u.id&#125;"</span>&gt;</span>Delete<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"user!updateUser.action?user.id=$&#123;u.id&#125;"</span>&gt;</span>Modify<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="title">c:forEach</span>&gt;</span></span><br><span class="line">    			</span><br><span class="line">    		<span class="tag">&lt;/<span class="title">table</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 添加用户按钮 --&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Add User"</span> <span class="attribute">onclick</span>=<span class="value">"window.location.href='adduser.jsp'"</span>/&gt;</span> </span><br><span class="line">    	<span class="tag">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line">    	</span><br><span class="line">        <span class="comment">&lt;!-- 查询用户输入框，包含 name、company 两种查询条件 --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">center</span>&gt;</span></span><br><span class="line">		   	<span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"user!queryUser.action"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span></span><br><span class="line">		   		user name<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.name"</span>/&gt;</span>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">		   		company<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.company"</span>/&gt;</span>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	</span><br><span class="line">		   		<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Search"</span>/&gt;</span></span><br><span class="line">		   <span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">br</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- tag&gt;0 表示查询结果正常--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">c:if</span> <span class="attribute">test</span>=<span class="value">"$&#123;tag&gt;0&#125;"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="title">center</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="title">table</span> <span class="attribute">border</span>=<span class="value">"1"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!-- 查询结果也以表格形式展现 --&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="title">tr</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="title">td</span>&gt;</span>user id<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>user name<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>company<span class="tag">&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    			<span class="comment">&lt;!-- users2 就是 UserAction 中的 queryUser() 返回的结果，同样是遍历 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">c:forEach</span> <span class="attribute">items</span>=<span class="value">"$&#123;users2&#125;"</span> <span class="attribute">var</span>=<span class="value">"u"</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;<span class="title">tr</span>&gt;</span></span><br><span class="line">    					<span class="tag">&lt;<span class="title">td</span>&gt;</span>$&#123;u.id&#125;<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>$&#123;u.name&#125;<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>$&#123;u.company &#125;<span class="tag">&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line">    				<span class="tag">&lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;/<span class="title">c:forEach</span>&gt;</span></span><br><span class="line">    			</span><br><span class="line">    		<span class="tag">&lt;/<span class="title">table</span>&gt;</span></span><br><span class="line">    		</span><br><span class="line">    	<span class="tag">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="title">c:if</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="3-_error-jsp">3. <code>error.jsp</code></h3><p>登录验证失败，给出一个错误页面提示即可，非常简单。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">%@</span> <span class="attribute">page</span> <span class="attribute">language</span>=<span class="value">"java"</span> <span class="attribute">contentType</span>=<span class="value">"text/html; charset=UTF-8"</span></span><br><span class="line">    <span class="attribute">pageEncoding</span>=<span class="value">"UTF-8"</span><span class="value">%</span>&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>Sorry!<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">Login failed!</span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-_adduser-jsp">4. <code>adduser.jsp</code></h3><p>增加用户的页面，注意 id 为主键，因此不能为空，也不能和其他的重复。把表单提交给 addUser Action 就可以了。</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="vbscript">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line"></span><span class="vbscript">&lt;%</span><br><span class="line"><span class="built_in">String</span> path = <span class="built_in">request</span>.getContextPath();</span><br><span class="line"><span class="built_in">String</span> basePath = <span class="built_in">request</span>.getScheme()+<span class="string">"://"</span>+<span class="built_in">request</span>.getServerName()+<span class="string">":"</span>+<span class="built_in">request</span>.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>Add New User<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">center</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span>Add User<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">    user id cannot be null or same as others</span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"user!addUser.action"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span></span><br><span class="line">        user id<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.id"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">        user name<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.name"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">        company<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.company"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Add"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="5-_updateuser-jsp">5. <code>updateuser.jsp</code></h3><p>修改用户信息，同上面类似（不提供 id 修改）。注意这里的 Action 为 <code>updateUserImpl</code>。</p>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="vbscript">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><span class="xml"></span><br><span class="line"> </span><br><span class="line"> </span><span class="vbscript">&lt;%</span><br><span class="line"><span class="built_in">String</span> path = <span class="built_in">request</span>.getContextPath();</span><br><span class="line"><span class="built_in">String</span> basePath = <span class="built_in">request</span>.getScheme()+<span class="string">"://"</span>+<span class="built_in">request</span>.getServerName()+<span class="string">":"</span>+<span class="built_in">request</span>.getServerPort()+path+<span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><span class="xml"></span><br><span class="line">    </span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>Modify User Info<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">center</span>&gt;</span> <span class="tag">&lt;<span class="title">h1</span>&gt;</span>Modify User Info<span class="tag">&lt;/<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"user!updateUserImpl.action"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">name</span>=<span class="value">"user.id"</span> <span class="attribute">value</span>=<span class="value">"$&#123;user.id&#125;"</span>  <span class="attribute">readonly</span>=<span class="value">"readonly"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">        user name<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.name"</span> <span class="attribute">value</span>=<span class="value">"$&#123;user.name&#125;"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">        company<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"user.company"</span> <span class="attribute">value</span>=<span class="value">"$&#123;user.company&#125;"</span>/&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"OK"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="6-_logout-jsp">6. <code>logout.jsp</code></h3><p>退出网站，把 session 清空，再设置页面跳转到首页登录页面即可。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="at_rule">@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">    </span><br><span class="line">&lt;% </span><br><span class="line">session.<span class="function">invalidate</span>()</span>; </span><br><span class="line"><span class="tag">response</span><span class="class">.sendRedirect</span>("<span class="tag">login</span><span class="class">.jsp</span>");</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h2 id="九、运行测试">九、运行测试</h2><h3 id="1-_登录">1. 登录</h3><p>右击项目，选择 <code>Run As</code> —&gt; <code>Run On Server</code>，稍等片刻，即可看到登录页面：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/A9DFF1A5C8E44A8CA9023AD1DB332959" alt=""></p>
<p>输入下面的命令，可以看到该数据库中，已经有 <code>ssh_test</code> 这张 table 了，但是目前还是张空表：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/80D34FB7355740858E89504E6D5D2EBA" alt=""></p>
<p>因为登录时我们要检查输入的数据是否存在与数据库中，因此我们先插入一条数据，例如:</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/2C01827FA47B439C8921325C3E7519A0" alt=""></p>
<p>再输入刚刚插入的数据，即可登录并进入管理页面（可以看到刚刚插入的数据，显示在页面上了）：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/604CD630DDEC4828BD8622C9AEA0E167" alt=""></p>
<h3 id="2-_用户管理（增删改查）">2. 用户管理（增删改查）</h3><h4 id="（1）新增用户">（1）新增用户</h4><p>点击 <code>Add User</code> 按钮，输入数据来新增用户，例如：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/1593EF2F9B614EA0AFA99D66E35805B6" alt=""></p>
<p>点击 <code>Add</code> 即可添加成功，页面展示：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/0171B1EBFBC9471AA2AFB1A4B2301179" alt=""></p>
<p>对比验证后台数据库中表的数据，也是一致的：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/17862FCE4D1E423C81C6A1021BCA804C" alt=""></p>
<h4 id="（2）删除用户">（2）删除用户</h4><p>我们把上面新增的 id 为 124 的用户删除掉，点击 Options 中的 Delete 即可：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/361C4AB451CE49668684D7F25774149D" alt=""></p>
<p>对比验证后台数据库中表的数据（保持一致），可以看到之前是两条数据，现在也只有一条了：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/6D22082036BE4D16BCCDAE45F8580FD5" alt=""></p>
<h4 id="（3）修改用户信息">（3）修改用户信息</h4><p>点击 Options 中的 Modify 修改用户信息，例如把 id 为 123 的用户信息修改为：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/BEBE5379F4714355A9658350B3435978" alt=""></p>
<p>可以看到修改成功了：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/89D512FC29AE4DF188E8377722241F01" alt=""></p>
<p>后台数据库也是一致的：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/DE2C8AE05C9F4CDB88A466A6679F818C" alt=""></p>
<h4 id="（4）查找用户">（4）查找用户</h4><p>为了演示查找的特性，我们先多新建几个用户，例如：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/8499C657713F410BA9953B95BA8F84A7" alt=""></p>
<p>我们先查找 <code>name=&quot;hr&quot;</code> （company 为空）的用户，结果为：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/9686A56CAB0D47B6A7A2F82B9E5E0786" alt=""></p>
<p>再查找 <code>company=&quot;shiyanlou&quot;</code> （name 为空）的用户，结果为：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/91F89A07AFCE4C149DEA149F5D52C6D8" alt=""></p>
<p>最后，再查找 <code>name=&quot;hr&quot;</code> 并且 <code>company=&quot;shiyanlou&quot;</code> 的用户：</p>
<p><img src="http://note.youdao.com/yws/public/resource/12c681e2df18bc54eb6a25937a634508/96B037FA1D8944809588232DB3E84B30" alt=""></p>
<p>可以看到，条件查找是很灵活、多样的。</p>
<h2 id="十、作业思考">十、作业思考</h2><ul>
<li><p>本次项目课的内容比较多，建议多动手操作几遍，并且仔细回顾和思考，才能真正理解。</p>
</li>
<li><p>退出操作存在不完善的地方，退出后按返回键仍然可以进行操作，考虑如何完善它。</p>
</li>
</ul>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/Hibernate/" class="post__tag__link">Hibernate</a></li><li class="post__tag__item"><a href="/tags/Java/" class="post__tag__link">Java</a></li><li class="post__tag__item"><a href="/tags/SSH/" class="post__tag__link">SSH</a></li><li class="post__tag__item"><a href="/tags/Spring/" class="post__tag__link">Spring</a></li><li class="post__tag__item"><a href="/tags/Struts/" class="post__tag__link">Struts</a></li></ul><a href="http://service.weibo.com/share/share.php?title=SSH 集合框架应用实例 - HENNG&amp;url=http://henng.com/2015/06/04/ssh/&amp;ralateUid=2492134057&amp;searchPic=true&amp;style=number" target="_blank" class="post__foot-link u-fr">SHARE</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2016 Henry Luo<bdi> | Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> with theme <a href="https://github.com/unmric/hexo-theme-strict" target="_blank">strict</a></bdi></div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="上一页" class="page-menu__link icon-arrow-left page-menu__link--disabled"> </span></li><li class="page-menu__item"><span title="下一页" class="page-menu__link icon-arrow-right page-menu__link--disabled"> </span></li></menu></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54955970-2', 'auto');
ga('send', 'pageview');
</script></body></html>